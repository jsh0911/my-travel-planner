<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRIP_PLANNER_PRO.EXE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
        }
        body { font-family: 'DungGeunMo', monospace; background-color: #008080; }
        .win-border { border-top: 2px solid white; border-left: 2px solid white; border-bottom: 2px solid #4a4a4a; border-right: 2px solid #4a4a4a; }
        .win-inset { border-top: 2px solid #4a4a4a; border-left: 2px solid #4a4a4a; border-bottom: 2px solid white; border-right: 2px solid white; }
        .tab-active { background-color: #c0c0c0 !important; border-bottom: none !important; font-weight: bold; z-index: 10; }
        .day-active { background-color: #000080 !important; color: white !important; }
    </style>
</head>
<body class="p-4 md:p-10">
    <div id="app" class="max-w-2xl mx-auto bg-[#c0c0c0] win-border p-1 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
        <div class="bg-gradient-to-r from-[#000080] to-[#1084d0] p-1 flex justify-between items-center mb-2">
            <div class="flex items-center gap-2 px-1">
                <i data-lucide="plane" class="w-4 h-4 text-white"></i>
                <span class="text-white font-bold text-xs md:text-sm">TRIP_PLANNER_PRO.EXE</span>
            </div>
            <div class="flex gap-1 pr-1">
                <button class="w-4 h-4 bg-[#c0c0c0] text-black border border-gray-400 flex items-center justify-center text-[10px]">X</button>
            </div>
        </div>

        <div class="flex gap-1 px-2 mb-0">
            <button onclick="switchTab('schedule')" id="tab-schedule" class="px-3 md:px-5 py-1 text-sm border-t-2 border-l-2 border-r-2 border-gray-600 bg-[#a0a0a0] flex items-center gap-2">ì¼ì •</button>
            <button onclick="switchTab('checklist')" id="tab-checklist" class="px-3 md:px-5 py-1 text-sm border-t-2 border-l-2 border-r-2 border-gray-600 bg-[#a0a0a0] flex items-center gap-2">ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
            <button onclick="switchTab('expense')" id="tab-expense" class="px-3 md:px-5 py-1 text-sm border-t-2 border-l-2 border-r-2 border-gray-600 bg-[#a0a0a0] flex items-center gap-2">ê²½ë¹„</button>
        </div>

        <div class="bg-[#c0c0c0] win-border border-white p-4">
            <h1 class="text-xl font-black italic text-pink-600 mb-4 flex items-center gap-2">
                <i data-lucide="sparkles" class="w-5 h-5"></i>
                <span id="tab-title">2ë°• 3ì¼ ì—¬í–‰ ì¼ì •</span>
            </h1>
            <div id="content-container"></div>
        </div>

        <div class="mt-2 border-t-2 border-gray-800 p-1 flex items-center justify-between text-[10px]">
            <div id="status-text" class="bg-gray-200 win-inset px-2 flex-1 overflow-hidden">System Status: READY</div>
        </div>
    </div>

    <script>
        // --- State Management ---
        let state = {
            activeTab: 'schedule',
            activeDay: 1,
            editingId: null,
            schedules: [],
            checklist: [],
            expenses: []
        };

        const STORAGE_KEY = 'TRIP_PLANNER_DATA';

        // --- Persistence Functions ---
        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({
                schedules: state.schedules,
                checklist: state.checklist,
                expenses: state.expenses
            }));
        }

        function loadFromStorage() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                const parsed = JSON.parse(savedData);
                state.schedules = parsed.schedules || [];
                state.checklist = parsed.checklist || [];
                state.expenses = parsed.expenses || [];
            } else {
                // ì´ˆê¸° ê¸°ë³¸ ë°ì´í„°
                state.schedules = [
                    { id: 1, day: 1, time: '10:00', text: 'ì¸ì²œê³µí•­ ë„ì°©' },
                    { id: 2, day: 2, time: '09:00', text: 'í˜¸í…” ì¡°ì‹' }
                ];
                state.checklist = [{ id: 101, text: 'ì—¬ê¶Œ ì±™ê¸°ê¸°', completed: false }];
                state.expenses = [{ id: 201, item: 'ë¹„í–‰ê¸°í‘œ', cost: 350000 }];
            }
        }

        // --- Logic Functions (Modified for Saving) ---
        function switchTab(tab) { state.activeTab = tab; state.editingId = null; render(); }
        function switchDay(day) { state.activeDay = day; state.editingId = null; render(); }

        function addItem(type, e) {
            e.preventDefault();
            const form = e.target;
            const now = Date.now();

            if (type === 'schedule') {
                const text = form.schedule.value;
                const time = form.time.value || '00:00';
                if (!text) return;
                state.schedules.push({ id: now, day: state.activeDay, time, text });
            } else if (type === 'checklist') {
                const text = form.checklist.value;
                if (!text) return;
                state.checklist.push({ id: now, text, completed: false });
            } else if (type === 'expense') {
                const item = form.expense.value;
                const cost = parseInt(form.cost.value);
                if (!item || isNaN(cost)) return;
                state.expenses.push({ id: now, item, cost });
            }
            saveToStorage();
            render();
        }

        function deleteItem(type, id) {
            state[type] = state[type].filter(i => i.id !== id);
            saveToStorage();
            render();
        }

        function toggleCheck(id) {
            const item = state.checklist.find(i => i.id === id);
            if (item) item.completed = !item.completed;
            saveToStorage();
            render();
        }

        function saveEdit(type, id) {
            const row = document.querySelector(`[data-id="${id}"]`);
            if (type === 'schedule') {
                const item = state.schedules.find(i => i.id === id);
                item.time = row.querySelector('.edit-time').value;
                item.text = row.querySelector('.edit-text').value;
            } else if (type === 'checklist') {
                const item = state.checklist.find(i => i.id === id);
                item.text = row.querySelector('.edit-text').value;
            } else if (type === 'expense') {
                const item = state.expenses.find(i => i.id === id);
                item.item = row.querySelector('.edit-item').value;
                item.cost = parseInt(row.querySelector('.edit-cost').value);
            }
            state.editingId = null;
            saveToStorage();
            render();
        }

        function startEdit(id) { state.editingId = id; render(); }
        function cancelEdit() { state.editingId = null; render(); }

        // --- Render Logic (Same as your original code structure) ---
        function render() {
            const container = document.getElementById('content-container');
            const title = document.getElementById('tab-title');
            const status = document.getElementById('status-text');

            document.querySelectorAll('[id^="tab-"]').forEach(btn => btn.classList.remove('tab-active'));
            document.getElementById(`tab-${state.activeTab}`).classList.add('tab-active');

            if (state.activeTab === 'schedule') {
                title.innerText = '2ë°• 3ì¼ ì—¬í–‰ ì¼ì •';
                status.innerText = `DAY ${state.activeDay} EDITING...`;
                
                let dayButtons = [1, 2, 3].map(d => `
                    <button onclick="switchDay(${d})" class="px-4 py-1 text-xs border-t border-l border-r border-gray-600 rounded-t-lg ${state.activeDay === d ? 'day-active' : 'bg-[#b0b0b0]'}">Day ${d}</button>
                `).join('');

                let listHtml = state.schedules.filter(s => s.day === state.activeDay).sort((a, b) => a.time.localeCompare(b.time)).map(item => {
                    if (state.editingId === item.id) {
                        return `<div class="flex gap-1 py-1" data-id="${item.id}"><input type="time" class="edit-time text-xs w-20 p-1" value="${item.time}"><input type="text" class="edit-text text-xs flex-1 p-1" value="${item.text}"><button onclick="saveEdit('schedule', ${item.id})" class="text-green-600">ğŸ’¾</button></div>`;
                    }
                    return `<div class="flex justify-between border-b border-dotted py-1"><div class="text-sm font-bold"><span>${item.time}</span> <span class="ml-2">${item.text}</span></div><div class="flex gap-2"><button onclick="startEdit(${item.id})">âœï¸</button><button onclick="deleteItem('schedules', ${item.id})">ğŸ—‘ï¸</button></div></div>`;
                }).join('');

                container.innerHTML = `<div class="flex gap-1 mb-4 border-b-2 border-gray-500">${dayButtons}</div><form onsubmit="addItem('schedule', event)" class="flex gap-2 mb-4"><input type="time" name="time" class="p-1 text-sm border-2 border-black"><input type="text" name="schedule" placeholder="ì¼ì •" class="flex-1 p-1 text-sm border-2 border-black"><button type="submit" class="bg-[#c0c0c0] win-border px-2 text-xs">ADD</button></form><div class="bg-white p-3 border-2 border-black min-h-[300px]">${listHtml || 'ê¸°ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.'}</div>`;
            } else if (state.activeTab === 'checklist') {
                // Checklist Render Logic (ê¸°ì¡´ê³¼ ë™ì¼í•˜ë˜ ì €ì¥ ê¸°ëŠ¥ ì—°ë™ë¨)
                title.innerText = 'PACKING LIST';
                let listHtml = state.checklist.map(item => `<div class="flex justify-between border-b py-1"><div><input type="checkbox" ${item.completed ? 'checked' : ''} onchange="toggleCheck(${item.id})"> <span class="${item.completed ? 'line-through text-gray-400' : ''}">${item.text}</span></div><button onclick="deleteItem('checklist', ${item.id})">ğŸ—‘ï¸</button></div>`).join('');
                container.innerHTML = `<form onsubmit="addItem('checklist', event)" class="flex gap-2 mb-4"><input type="text" name="checklist" class="flex-1 p-1 border-2 border-black text-sm"><button type="submit" class="bg-[#c0c0c0] win-border px-2 text-xs">ADD</button></form><div class="bg-white p-3 border-2 border-black min-h-[300px]">${listHtml}</div>`;
            } else if (state.activeTab === 'expense') {
                // Expense Render Logic (ê¸°ì¡´ê³¼ ë™ì¼í•˜ë˜ ì €ì¥ ê¸°ëŠ¥ ì—°ë™ë¨)
                title.innerText = 'BUDGET TRACKER';
                let total = state.expenses.reduce((sum, i) => sum + i.cost, 0);
                let listHtml = state.expenses.map(item => `<div class="flex justify-between py-1"><span>${item.item}</span><span>${item.cost.toLocaleString()}ì› <button onclick="deleteItem('expenses', ${item.id})">ğŸ—‘ï¸</button></span></div>`).join('');
                container.innerHTML = `<form onsubmit="addItem('expense', event)" class="flex gap-2 mb-4"><input type="text" name="expense" class="flex-1 p-1 border-2 border-black text-sm"><input type="number" name="cost" class="w-20 p-1 border-2 border-black text-sm"><button type="submit" class="bg-[#c0c0c0] win-border px-2 text-xs">ADD</button></form><div class="bg-white p-3 border-2 border-black min-h-[250px]">${listHtml}</div><div class="bg-yellow-100 p-2 border-t-2 border-black text-right font-black">TOTAL: ${total.toLocaleString()}ì›</div>`;
            }
            lucide.createIcons();
        }

        window.onload = () => { loadFromStorage(); render(); };
    </script>
</body>
</html>
