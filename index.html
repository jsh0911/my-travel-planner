import React, { useState } from 'react';
import { 
  Plus, Trash2, Heart, Sparkles, Plane, 
  Music, Edit3, Save, X, Wallet, Calendar, CheckSquare, Sun, Moon, Sunrise
} from 'lucide-react';

export default function App() {
  // ÏÉÅÌÉú Í¥ÄÎ¶¨: Î©îÏù∏ ÌÉ≠, ÏÑúÎ∏å ÏùºÏ∞®(Day), ÏûÖÎ†•Í∞í, ÏàòÏ†ï ÏÉÅÌÉú
  const [activeTab, setActiveTab] = useState('schedule');
  const [activeDay, setActiveDay] = useState(1);
  const [editingId, setEditingId] = useState(null);
  const [editValue, setEditValue] = useState({});

  // Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨
  const [schedules, setSchedules] = useState([
    { id: 1, day: 1, time: '10:00', text: 'Ïù∏Ï≤úÍ≥µÌï≠ ÎèÑÏ∞©' },
    { id: 2, day: 2, time: '09:00', text: 'Ìò∏ÌÖî Ï°∞Ïãù Î∞è Ï∂úÎ∞ú' },
    { id: 3, day: 3, time: '14:00', text: 'Í∏∞ÎÖêÌíà ÏáºÌïë' }
  ]);
  const [checklist, setChecklist] = useState([
    { id: 1, text: 'Ïó¨Í∂å Ï±ôÍ∏∞Í∏∞', completed: false }
  ]);
  const [expenses, setExpenses] = useState([
    { id: 1, item: 'ÎπÑÌñâÍ∏∞Ìëú', cost: 350000 }
  ]);

  // ÏûÖÎ†• Ìèº ÏÉÅÌÉú
  const [inputs, setInputs] = useState({ schedule: '', time: '', checklist: '', expense: '', cost: '' });

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setInputs(prev => ({ ...prev, [name]: value }));
  };

  // --- ÏùºÏ†ï (Schedule) Í∏∞Îä• ---
  const addSchedule = (e) => {
    e.preventDefault();
    if (!inputs.schedule) return;
    setSchedules([...schedules, { 
      id: Date.now(), 
      day: activeDay, 
      time: inputs.time || '00:00', 
      text: inputs.schedule 
    }]);
    setInputs({ ...inputs, schedule: '', time: '' });
  };

  // --- Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ (Checklist) Í∏∞Îä• ---
  const addChecklist = (e) => {
    e.preventDefault();
    if (!inputs.checklist) return;
    setChecklist([...checklist, { id: Date.now(), text: inputs.checklist, completed: false }]);
    setInputs({ ...inputs, checklist: '' });
  };

  // --- Í≤ΩÎπÑ (Expenses) Í∏∞Îä• ---
  const addExpense = (e) => {
    e.preventDefault();
    if (!inputs.expense || !inputs.cost) return;
    setExpenses([...expenses, { id: Date.now(), item: inputs.expense, cost: parseInt(inputs.cost) }]);
    setInputs({ ...inputs, expense: '', cost: '' });
  };

  // Í≥µÌÜµ ÏÇ≠Ï†ú Î°úÏßÅ
  const deleteItem = (type, id) => {
    if (type === 'schedule') setSchedules(schedules.filter(i => i.id !== id));
    if (type === 'checklist') setChecklist(checklist.filter(i => i.id !== id));
    if (type === 'expense') setExpenses(expenses.filter(i => i.id !== id));
  };

  // Í≥µÌÜµ ÏàòÏ†ï Î°úÏßÅ
  const startEdit = (type, item) => {
    setEditingId(item.id);
    setEditValue(item);
  };

  const saveEdit = (type) => {
    if (type === 'schedule') setSchedules(schedules.map(i => i.id === editingId ? editValue : i));
    if (type === 'checklist') setChecklist(checklist.map(i => i.id === editingId ? editValue : i));
    if (type === 'expense') setExpenses(expenses.map(i => i.id === editingId ? { ...editValue, cost: parseInt(editValue.cost) } : i));
    setEditingId(null);
  };

  const totalExpense = expenses.reduce((sum, item) => sum + item.cost, 0);

  // ÏùºÏ∞®Î≥Ñ ÌïÑÌÑ∞ÎßÅ
  const filteredSchedules = schedules
    .filter(s => s.day === activeDay)
    .sort((a, b) => a.time.localeCompare(b.time));

  return (
    <div className="min-h-screen bg-[#008080] p-4 md:p-10 font-mono text-black">
      <div className="max-w-2xl mx-auto bg-[#c0c0c0] border-t-2 border-l-2 border-white border-b-2 border-r-2 border-gray-800 p-1 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)]">
        
        {/* Title Bar */}
        <div className="bg-gradient-to-r from-[#000080] to-[#1084d0] p-1 flex justify-between items-center mb-2">
          <div className="flex items-center gap-2 px-1">
            <Plane className="w-4 h-4 text-white" />
            <span className="text-white font-bold text-xs md:text-sm">TRIP_PLANNER_PRO.EXE</span>
          </div>
          <div className="flex gap-1 text-white text-xs pr-1">
            <button className="w-4 h-4 bg-[#c0c0c0] text-black border border-gray-400 flex items-center justify-center">_</button>
            <button className="w-4 h-4 bg-[#c0c0c0] text-black border border-gray-400 flex items-center justify-center">X</button>
          </div>
        </div>

        {/* Tab Navigation (Main) */}
        <div className="flex gap-1 px-2 mb-0">
          {[
            { id: 'schedule', label: 'ÏùºÏ†ï', icon: Calendar },
            { id: 'checklist', label: 'Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏', icon: CheckSquare },
            { id: 'expense', label: 'Í≤ΩÎπÑ', icon: Wallet }
          ].map(tab => (
            <button
              key={tab.id}
              onClick={() => { setActiveTab(tab.id); setEditingId(null); }}
              className={`px-3 md:px-5 py-1 text-sm border-t-2 border-l-2 border-r-2 flex items-center gap-2 ${
                activeTab === tab.id 
                ? 'bg-[#c0c0c0] border-white z-10 -mb-[2px] font-bold' 
                : 'bg-[#a0a0a0] border-gray-600 text-gray-700'
              }`}
            >
              <tab.icon className="w-3 h-3" /> {tab.label}
            </button>
          ))}
        </div>

        {/* Main Content Area */}
        <div className="bg-[#c0c0c0] border-2 border-white border-b-gray-800 border-r-gray-800 p-4">
          
          <h1 className="text-xl font-black italic text-pink-600 mb-4 drop-shadow-[1px_1px_0px_rgba(0,255,255,1)] flex items-center gap-2">
            <Sparkles className="animate-pulse w-5 h-5" /> 
            {activeTab === 'schedule' ? `2Î∞ï 3Ïùº Ïó¨Ìñâ ÏùºÏ†ï` : activeTab === 'checklist' ? 'PACKING LIST' : 'BUDGET TRACKER'}
          </h1>

          {/* 1. Schedule Tab */}
          {activeTab === 'schedule' && (
            <div>
              {/* Day Sub-Tabs */}
              <div className="flex gap-1 mb-4 border-b-2 border-gray-500 pb-0">
                {[1, 2, 3].map(day => (
                  <button
                    key={day}
                    onClick={() => { setActiveDay(day); setEditingId(null); }}
                    className={`px-4 py-1 text-xs border-t border-l border-r border-gray-600 rounded-t-lg transition-all ${
                      activeDay === day 
                      ? 'bg-blue-800 text-white font-bold -mb-[2px] py-2' 
                      : 'bg-[#b0b0b0] text-gray-800 hover:bg-[#a0a0a0]'
                    }`}
                  >
                    Day {day} {day === 1 ? 'üõ´' : day === 2 ? 'üì∏' : 'üè†'}
                  </button>
                ))}
              </div>

              <form onSubmit={addSchedule} className="flex flex-wrap gap-2 mb-4 bg-white/30 p-2 border border-gray-500">
                <input type="time" name="time" value={inputs.time} onChange={handleInputChange} className="p-1 border-2 border-gray-800 text-sm" />
                <input type="text" name="schedule" value={inputs.schedule} onChange={handleInputChange} placeholder="Ìï† Ïùº ÏûÖÎ†•" className="flex-1 p-1 border-2 border-gray-800 text-sm min-w-[120px]" />
                <button type="submit" className="bg-[#c0c0c0] border-2 border-white border-b-black border-r-black px-3 py-1 font-bold text-xs shadow-sm active:translate-y-[1px]">Ï∂îÍ∞Ä</button>
              </form>

              <div className="space-y-2 bg-white p-3 border-2 border-gray-800 min-h-[300px] shadow-inner">
                <p className="text-[10px] text-blue-600 font-bold mb-2">ÌòÑÏû¨ ÏÑ†ÌÉù: DAY {activeDay} SCHEDULE</p>
                {filteredSchedules.map(item => (
                  <div key={item.id} className="flex items-center justify-between border-b border-dotted border-gray-400 pb-1 hover:bg-yellow-50 px-1">
                    {editingId === item.id ? (
                      <div className="flex gap-1 w-full">
                        <input type="time" value={editValue.time} onChange={(e) => setEditValue({...editValue, time: e.target.value})} className="border border-blue-500 text-xs w-20 p-1" />
                        <input type="text" value={editValue.text} onChange={(e) => setEditValue({...editValue, text: e.target.value})} className="border border-blue-500 text-xs flex-1 p-1" />
                        <button onClick={() => saveEdit('schedule')}><Save className="w-4 h-4 text-green-600"/></button>
                        <button onClick={() => setEditingId(null)}><X className="w-4 h-4 text-red-600"/></button>
                      </div>
                    ) : (
                      <>
                        <div className="flex gap-3 items-center">
                          <span className="bg-blue-800 text-white px-1 text-[10px] font-bold shadow-sm">{item.time}</span>
                          <span className="text-sm font-bold text-gray-800">{item.text}</span>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => startEdit('schedule', item)} className="text-gray-400 hover:text-blue-600"><Edit3 className="w-3 h-3"/></button>
                          <button onClick={() => deleteItem('schedule', item.id)} className="text-gray-400 hover:text-red-600"><Trash2 className="w-3 h-3"/></button>
                        </div>
                      </>
                    )}
                  </div>
                ))}
                {filteredSchedules.length === 0 && (
                  <div className="text-center py-10 italic text-gray-400 text-xs">Í≥ÑÌöçÎêú ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§.</div>
                )}
              </div>
            </div>
          )}

          {/* 2. Checklist Tab */}
          {activeTab === 'checklist' && (
            <div>
              <form onSubmit={addChecklist} className="flex gap-2 mb-6 bg-white/30 p-2 border border-gray-500">
                <input type="text" name="checklist" value={inputs.checklist} onChange={handleInputChange} placeholder="Ï±ôÍ∏∏ Î¨ºÍ±¥..." className="flex-1 p-1 border-2 border-gray-800 text-sm" />
                <button type="submit" className="bg-[#c0c0c0] border-2 border-white border-b-black border-r-black px-4 py-1 font-bold text-xs">Ï∂îÍ∞Ä</button>
              </form>
              <div className="space-y-2 bg-white p-3 border-2 border-gray-800 min-h-[300px]">
                {checklist.map(item => (
                  <div key={item.id} className="flex items-center justify-between border-b border-gray-100 py-1">
                    {editingId === item.id ? (
                      <div className="flex gap-1 w-full">
                        <input type="text" value={editValue.text} onChange={(e) => setEditValue({...editValue, text: e.target.value})} className="border border-blue-500 text-xs flex-1 p-1" />
                        <button onClick={() => saveEdit('checklist')}><Save className="w-4 h-4 text-green-600"/></button>
                      </div>
                    ) : (
                      <>
                        <div className="flex items-center gap-2">
                          <button onClick={() => setChecklist(checklist.map(i => i.id === item.id ? {...i, completed: !i.completed} : i))}>
                            {item.completed ? <Heart className="w-4 h-4 text-pink-500 fill-pink-500 animate-bounce" /> : <div className="w-4 h-4 border border-black bg-gray-50" />}
                          </button>
                          <span className={`text-sm ${item.completed ? 'line-through text-gray-400 font-normal' : 'font-bold'}`}>{item.text}</span>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => startEdit('checklist', item)} className="text-gray-300 hover:text-blue-500"><Edit3 className="w-3 h-3"/></button>
                          <button onClick={() => deleteItem('checklist', item.id)} className="text-gray-300 hover:text-red-500"><Trash2 className="w-3 h-3"/></button>
                        </div>
                      </>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* 3. Expense Tab */}
          {activeTab === 'expense' && (
            <div>
              <form onSubmit={addExpense} className="flex flex-wrap gap-2 mb-6 bg-white/30 p-2 border border-gray-500">
                <input type="text" name="expense" value={inputs.expense} onChange={handleInputChange} placeholder="Ìï≠Î™©" className="flex-1 p-1 border-2 border-gray-800 text-sm min-w-[100px]" />
                <input type="number" name="cost" value={inputs.cost} onChange={handleInputChange} placeholder="Í∏àÏï°" className="w-24 p-1 border-2 border-gray-800 text-sm" />
                <button type="submit" className="bg-[#c0c0c0] border-2 border-white border-b-black border-r-black px-4 py-1 font-bold text-xs">Ï∂îÍ∞Ä</button>
              </form>
              <div className="bg-white border-2 border-gray-800 min-h-[300px] flex flex-col">
                <div className="p-3 flex-1 overflow-y-auto">
                  {expenses.map(item => (
                    <div key={item.id} className="flex items-center justify-between border-b border-gray-100 text-sm py-2">
                      {editingId === item.id ? (
                        <div className="flex gap-1 w-full">
                          <input type="text" value={editValue.item} onChange={(e) => setEditValue({...editValue, item: e.target.value})} className="border border-blue-500 text-xs flex-1 p-1" />
                          <input type="number" value={editValue.cost} onChange={(e) => setEditValue({...editValue, cost: e.target.value})} className="border border-blue-500 text-xs w-20 p-1" />
                          <button onClick={() => saveEdit('expense')}><Save className="w-4 h-4 text-green-600"/></button>
                        </div>
                      ) : (
                        <>
                          <div className="flex flex-col">
                            <span className="font-bold text-gray-700">{item.item}</span>
                            <span className="text-[10px] text-gray-400">ID_{item.id.toString().slice(-4)}</span>
                          </div>
                          <div className="flex items-center gap-3">
                            <span className="text-blue-800 font-bold bg-blue-50 px-1">{item.cost.toLocaleString()}Ïõê</span>
                            <button onClick={() => startEdit('expense', item)}><Edit3 className="w-3 h-3 text-gray-300 hover:text-blue-500"/></button>
                            <button onClick={() => deleteItem('expense', item.id)}><Trash2 className="w-3 h-3 text-gray-300 hover:text-red-500"/></button>
                          </div>
                        </>
                      )}
                    </div>
                  ))}
                </div>
                <div className="bg-yellow-100 p-2 border-t-2 border-gray-800 flex justify-between items-center shadow-[inset_0_2px_4px_rgba(0,0,0,0.1)]">
                  <span className="text-xs font-bold text-gray-600 flex items-center gap-1"><Sparkles className="w-3 h-3" />TOTAL_COST</span>
                  <span className="text-lg font-black text-red-600 underline decoration-double">{totalExpense.toLocaleString()}Ïõê</span>
                </div>
              </div>
            </div>
          )}
        </div>

        {/* Status Bar */}
        <div className="mt-2 border-t-2 border-gray-800 p-1 flex items-center justify-between text-[10px]">
          <div className="bg-gray-200 border-inset px-2 border border-gray-600 flex-1 overflow-hidden whitespace-nowrap">
            System Status: {activeTab === 'schedule' ? `DAY ${activeDay} EDITING...` : 'ONLINE'}
          </div>
          <div className="bg-gray-200 border-inset px-2 border border-gray-600 ml-1 italic flex items-center gap-1 shrink-0">
            <Music className="w-2 h-2" /> TRAVEL.MIDI
          </div>
        </div>
      </div>
    </div>
  );
}
